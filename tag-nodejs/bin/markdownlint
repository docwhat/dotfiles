#!/bin/bash

##marker: NODEJS-CLI-TOOL##

set -eEuo pipefail

bin=markdownlint
packages=( markdownlint-cli )
node_version=10
prefix="${HOME}/.cache/nodejs-cli-tool/node-${node_version}"

export NODENV_VERSION=$node_version

function do_install() {
  npm install --global --prefix "$prefix" "${packages[@]}"
}

if [ -n "${TOOL_INSTALL:-}" ]; then
  do_install
  exit
fi

local_bin="$(npm bin 2>/dev/null)"
global_bin="${prefix}/bin"

if [ -x "${local_bin}/${bin}" ]; then
  exec "${local_bin}/${bin}" "$@"
fi

if [ -x "${global_bin}/${bin}" ]; then
  exec "${global_bin}/${bin}" "$@"
fi

do_install >/dev/null 2>&1
exec "${global_bin}/${bin}" "$@"

# EOF
