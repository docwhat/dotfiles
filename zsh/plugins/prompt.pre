pretty_hostname() {
  local h

  if [ -n "$SHORT_HOST" ]; then
    h=$SHORT_HOST
  else
    h="%m"
  fi
  if [[ -n "$SSH_CLIENT" || -n "$SSH_TTY" ]]; then
    h="%{%F{yellow}%}${h}%{%f%}"
  fi
  echo "${(%)h}"
}

if ! (( $+functions[prompt_newline] )); then
  prompt_newline() {
    local lws
    [[ "$1" == "right" ]] && return
    lws=$POWERLEVEL9K_WHITESPACE_BETWEEN_LEFT_SEGMENTS
    POWERLEVEL9K_WHITESPACE_BETWEEN_LEFT_SEGMENTS=
    "$1_prompt_segment" \
      "$0" \
      "$2" \
      "NONE" "NONE" $'\n'
    POWERLEVEL9K_WHITESPACE_BETWEEN_LEFT_SEGMENTS=$lws
  }
fi

# general
POWERLEVEL9K_MODE='nerdfont-complete'
export POWERLEVEL9K_MODE # To use in VIM, etc.

# Bug https://github.com/bhilburn/powerlevel9k/pull/752
POWERLEVEL9K_VCS_GIT_ICON=$'\uF1D3 '          # 
POWERLEVEL9K_VCS_GIT_GITHUB_ICON=$'\uF113 '   # 

# Use the pretty_hostname so that we don't show the
# constantly changing hostname when using wifi.
POWERLEVEL9K_CONTEXT_TEMPLATE="%n@$(pretty_hostname)"

if (( $+functions[nodenv] )); then
  docwhat_nodenv_pill() {
    local ver="$(nodenv version-name)"

    if [ -n "$NODENV_VERSION" ] || [ "$(nodenv global)" != "$ver" ]; then
      echo -n $'\ue718' "$ver"
    fi
  }
else
  docwhat_nodenv_pill() {
    return
  }
fi

POWERLEVEL9K_CUSTOM_NODENV=docwhat_nodenv_pill
POWERLEVEL9K_CUSTOM_NODENV_BACKGROUND=022
POWERLEVEL9K_CUSTOM_NODENV_FOREGROUND=255

POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(
os_icon
context
dir
dir_writable

# custom_nodenv
# rbenv
vcs
# docker_machine

newline

root_indicator
background_jobs
status
)

if [ -x "$VIM" ]; then
  POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(
  dir
  dir_writable
  vcs
  root_indicator
  background_jobs
  status
  )
fi

POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(
command_execution_time
)
if [ -z "$TMUX" ] && ! [ -x "$VIM" ]; then
  POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(
  "${POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS[@]}"
  time
  )
fi

# command_execution_time
POWERLEVEL9K_COMMAND_EXECUTION_TIME_THRESHOLD=6
POWERLEVEL9K_COMMAND_EXECUTION_TIME_PRECISION=1

# root_indicator
POWERLEVEL9K_ROOT_INDICATOR_FOREGROUND=red

# nvm
POWERLEVEL9K_NVM_BACKGROUND=magenta
POWERLEVEL9K_NVM_FOREGROUND=black

# go_version
POWERLEVEL9K_GO_VERSION_BACKGROUND=magenta
POWERLEVEL9K_GO_VERSION_FOREGROUND=black

# dir
POWERLEVEL9K_SHORTEN_STRATEGY='truncate_with_package_name'
POWERLEVEL9K_SHORTEN_DELIMITER='…'
POWERLEVEL9K_DIR_HOME_BACKGROUND=75
POWERLEVEL9K_DIR_HOME_FOREGROUND=16
POWERLEVEL9K_DIR_HOME_SUBFOLDER_BACKGROUND=75
POWERLEVEL9K_DIR_HOME_SUBFOLDER_FOREGROUND=16
POWERLEVEL9K_DIR_DEFAULT_BACKGROUND=75
POWERLEVEL9K_DIR_DEFAULT_FOREGROUND=16

# status
POWERLEVEL9K_STATUS_SHOW_PIPESTATUS=true # pending PR #515

# time
POWERLEVEL9K_TIME_BACKGROUND=75
POWERLEVEL9K_TIME_FORMAT='%@ %D{%Y-%m-%d}'

# vcs
POWERLEVEL9K_CHANGESET_HASH_LENGTH=8
POWERLEVEL9K_VCS_CLEAN_BACKGROUND='green'
POWERLEVEL9K_VCS_UNTRACKED_BACKGROUND='yellow'
POWERLEVEL9K_VCS_MODIFIED_BACKGROUND='yellow'

# vim:set et sw=2 ts=2 ft=zsh:
