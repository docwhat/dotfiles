#!/usr/bin/env bash

# https://github.com/kovidgoyal/kitty/issues/719

set -eEuo pipefail

if ! [[ -d ${TMPDIR:-} ]]; then
  TMPDIR="/tmp/user-$(id -u)"
  mkdir -m 0700 "$TMPDIR"
fi
declare -r buffer="${TMPDIR}/kitty_scrollback_buffer.$$"
trap 'rm -f "${buffer}"' EXIT

nvim \
  -u NONE \
  -c "set nonumber nolist showtabline=0 foldcolumn=0 laststatus=0" \
  -c "autocmd TermOpen * normal G" \
  -c "map q :qa!<CR>" \
  -c "set clipboard+=unnamedplus" \
  -c "silent write! $buffer | terminal cat '$buffer' - "

# EOF
